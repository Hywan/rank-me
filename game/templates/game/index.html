{% extends "base.html" %}

{% load admin_urls historical_scores %}

{% block content %}

    <a href="{% url 'game_add' %}" class="btn btn-success">Add a result</a>

    <div class="row">
        <div class="span6">
            <div class="scores">
                <h2>Scores</h2>
                {% if score_board %}
                    <ol class="score-board">
                        {% for team in score_board %}
                            <li class="score-item" title="W: {{ team.wins }}, L: {{ team.defeats }}, Ïƒ: {{ team.stdev|floatformat:"5" }}"><strong>{{ team }}</strong> ({{ team.score|floatformat }})</li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p>No scores registered yet.</p>
                {% endif %}
            </div>
        </div>

        <div class="span6">
            <div class="latest-results">
                {% if latest_results %}
                    <h2>Last 20 games</h2>
                    <ul class="games">
                    {% for result in latest_results %}
                        <li class="game-item">
                            <a href="{% url 'game_detail' result.id %}">{{ result }} - {{ result.date }}</a>
                        </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>No result yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        {% historical_scores nb_games=50 %}
    </div>
{% endblock %}

{% block extra_footer_js %}
<script type="text/javascript">
    $(function () {
        function mapToPosition(element) {
            return element.position;
        };

        var scores_by_team = {{ scores_by_team_json|safe }};

        var positionSeries = [];
        for (var team in scores_by_team) {
            positionSeries.push({'name': team, 'data': scores_by_team[team].map(mapToPosition)});
        }

        $('#historical-scores-chart').highcharts({
            title: {
                text: 'Last {{ nb_games }} games',
                x: -20 //center
            },
            xAxis: {
                type: 'linear'
            },
            yAxis: {
                title: {
                    text: 'Score'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                reversed: true,
                gridLineColor: '#fff',
                min: 1
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: positionSeries
        });
    });
</script>
{% endblock %}
